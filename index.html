<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Last.fm Playlists</title>

    <!-- css files -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">
    <link href="css/main.css" rel="stylesheet" type="text/css">

    <!-- load jquery and jsrender libraries -->
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/jsrender.js"></script>

    <!-- and new libraries to use lastfm -->
    <script type="text/javascript" src="js/lastfm.api.md5.js"></script>
    <script type="text/javascript" src="js/lastfm.api.js"></script>
    <script type="text/javascript" src="js/lastfm.api.cache.js"></script>


    <!-- define templates for the units -->
    
    <script id="lastfmTemplateArtistInfo" type="text/x-jsrender">
        <div class="artist_info">
            <a href="{{:url}}" rel="nofollow" target="_blank"><b>{{:name}}:</b><img src="{{:image[3]["#text"]}}" alt="{{:name}}" /></a>
            <div><noindex>
                {{:bio.content}}
            </noindex></div>
        </div>
    </script>

    <script id="lastfmTemplateTracks" type="text/x-jsrender">
        <div id="{{:mbid}}" class="track">
            <a href="{{:url}}" rel="nofollow" target="_blank">{{:name}}</a>
            {{:playcount}}
        </div>
    </script>

    <!-- API data lookup -->

    <script type="text/javascript">
                var trackData = new Array();
                //var artistName = $('#nextArtist').val();
                //var trackName = '';
                //var playCount = '';

                // define api keys
                var apiKey = '16a94af784ef5b8ba09ca91d10ffa7d7';
                var apiSecret = '31d6fc5b7c2ed16737be4be59c6e6dc1';

                // create a Cache object
                var cache = new LastFMCache();

                // create a LastFM object
                var lastfm = new LastFM({
                    apiKey: apiKey,
                    apiSecret: apiSecret,
                    cache: cache
                });


                function queryTracks(artistName){
                    searchName = $('#nextArtist').val();
                    artistName = typeof artistName !== 'undefined' ? artistName : searchName;
                // load details of the artist
                lastfm.artist.getInfo({
                    artist: artistName
                }, {
                    success: function (data) {
                        // render the single artist info using 'lastfmTemplateArtistInfo' template
                        $('#top_artist').html(
                        $('#lastfmTemplateArtistInfo').render(data.artist));
                        // load the artis's top tracks
                        lastfm.artist.getTopTracks({
                            artist: artistName,
                            limit: 6
                        }, {
                            success: function (data) {
                                // render the tracks using 'lastfmTemplateTracks' template
                                $('#top_tracks').html(
                                $('#lastfmTemplateTracks').render(data.toptracks.track));
                            }
                        });
                    },
                    error: function (code, message) {
                        alert('Error #' + code + ': ' + message);
                    }
                });
                };



        $(function () {
            //$("#searchButton").click(queryTracks())});


          // send team data to server
/*          $.ajax({
            url: "/backliftapp/tracks",
            type: "POST",
            dataType: "JSON",
            data: {
              artist: artistName,
              trackName: trackName,
              playCount: playCount
            }, //end data
            success: function (data) {

              // update trackdata array
              trackData.push(data);

              // update topTracks table
              updatetopTracks();

            } //end success
          }); // end POST

// *************** update topTracks table *****************
function updatetopTracks(){

    // create empty array
    var sort = new Array();

    // fill array with track data
    for (var i = 0; i < trackData.length; i++) {
      sort.push(trackData[i]);
    };

    // sort array by win percentage using bubble sort
    for (var j = 0; j < (sort.length - 1); j++) {
      var swapping = false;
      for (var k = 0; k < ((sort.length - 1) - j); k++) {
        if (sort[k].playCount < sort[k + 1].playCount) {
          var temp = sort[k];
          sort[k] = sort[k + 1];
          sort[k + 1] = temp;
          swapping = true;
        };
      };
      if (!swapping) {
      break;
      };
    };

    // clear track table
    $("#topTracks tbody").html("");

    // populate track table
    for (var l = 0; l < sort.length; l++) {
      $("#topTracks tbody").append("<tr><th class='rank'>" + (l + 1) + ".</th><td class='artist'>" + sort[l].artistName + "</td><td class='track'>" + sort[l].trackName + "</td><td class='count'>" + sort[l].playCount + "</td></tr>");
    }; // end for loop

  }; // end updatetopTracks

          }); //end click function */
}); // end ready 
    </script>
</head>
<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="brand" href="#">Last.fm Playlists</a>
                <div class="nav-collapse collapse">
                    <ul class="nav">
                        <li>
                            <a href="http://www.last.fm/"><img src="img/Logos/Last.fm_Logo_Black.jpg" width="10%" height="10%" class="pull-right" /></a>
                        </li>
                    </ul>
                </div><!--/.nav-collapse -->
            </div>
        </div>
    </div>

    <div class="container">
        <div>
            <hr>
            <hr>
        </div>
   
        <div class="row-fluid">
            <div class="span12 content-main">
                <div class="content-body">
                    <form class="form-horizontal">
                        <div class="control-group">
                            <label class="control-label" for="nextArtist"><h2>Enter Artist:</h2></label>
                            <div class="controls">
                                <input type="text" id="nextArtist" placeholder="Artist Name">
                                <button type="button" class="btn btn-primary" id="searchButton" onclick='queryTracks();'>Submit</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="content-body">
                    <div class="content-body-inner" id="top_artist"></div>
                </div>
                <div class="content-body">
                    <h2>Top tracks:</h2>
                    <div class="content-body-inner" id="top_tracks"></div>
                    <table>
                        <thead>
                            <tr>
                                <th class="rank">Rank</th>
                                <th class="artist">Artist</th>
                                <th class="track">Track</th>
                                <th class="count">Plays</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</body>
</html>